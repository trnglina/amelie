{"version":3,"sources":["read-bar.js"],"names":["body","document","getElementsByTagName","toggleButton","getElementsByClassName","container","article","template","ReadBar","createElement","trim","firstChild","style","display","isExpanded","bar","classList","contains","updatePosition","window","clientWidth","this","disabled","remove","left","setExpanded","expanded","add","toggle","toc","root","className","i","children","length","node","newNode","newNodeContent","nodeName","innerHTML","href","id","appendChild","onfocus","addEventListener","_ref","altKey","keyCode","insertBefore"],"mappings":"cAWA,WAEC,IA+FOA,EAAOC,SAASC,qBAAqB,QAAQ,GAT7CC,EAAJF,SAAuBG,qBAAuB,QAAA,GAC1CD,EAAAA,EAAJD,qBAAA,WAAA,GAEIG,EAAAA,IAtFU,SAAUC,GAA1B,IACWC,EADLC,IACKD,EAAIN,SAAMQ,cAAA,QACXF,UAAWN,2LADnBS,OAOEH,EAASI,WAAWC,MAAMC,QAAU,OAIlCC,EAAaH,YA6EjB,OA7EAI,EAAID,WAAa,WAAA,OAAMC,EAAIC,UAAUC,SAAS,aAG5CF,EAAAG,eAAcL,WAeZ,GAdoB,QAApBE,EAAIH,MAAMC,UACXE,EAAAH,MAAAC,QAAA,SAICM,OAAKhB,WAFPG,EAGOc,YAAA,GAAAC,KAAAD,YACLC,KAAIN,aAAAO,UAAkB,GAErBP,EAAAD,cADCC,EAAIC,UAAUO,OAAO,YAGxBF,KAAAlB,aAAAmB,UAAA,GAGCP,EAAMS,aAKNH,KAAKT,MAAMY,KAAO,OALGJ,CAArB,IAAMI,EAAOlB,EAAQc,YAAc,GAAkB,KACjDC,KAAKT,MAAMY,MAAQA,IACrBH,KAAKT,MAAMY,KAAOA,KAOxBT,EAAIU,YAAc,SAAUC,GACtBA,EACFX,EAAIC,UAAUW,IAAI,YAGlBZ,EAAIC,UAAUO,OAAO,YAFrBR,EAAIG,kBAORH,EAAIa,OAAS,WACPb,EAAID,aACNC,EAAIU,aAAY,GAEhBV,EAAIU,aAAY,IAIpBV,EAAIc,IAAO,WACT,IAAMC,EAAO7B,SAASQ,cAAc,MACpCqB,EAAKC,UAAY,WACjB,IAAK,IAAIC,EAAI,EAAGA,EAAI1B,EAAQ2B,SAASC,OAAQF,IAAK,CAAlD,IAAKG,EAAL7B,EAAoBA,SAAQ2B,GAC1B,OAAUE,EAAG7B,UAEX,IAAK,KADP,IAAA,KACE,IAAK,KACL,IAAK,KACL,IAAK,KACL,IAAK8B,EAALnC,SAAAQ,cAAA,MACK4B,EAALpC,SAAAQ,cAAA,KACE4B,EAAgBpC,UAASQ,EAAAA,SACzB4B,EAAMA,UAAiBpC,EAASQ,UAChC4B,EAAeN,KAAAA,IAAYI,EAAKG,GAChCD,EAAeE,QAAf,WAAA,OAA+BxB,EAACwB,aAAhC,IACAF,EAAeG,OAAO,WAAA,OAAML,EAAKM,aAAjC,IAGAL,EAAQM,YAAYL,GAFpBA,EAAAA,YAAeM,IACfN,OAAAA,EAjBG,GA0BXtB,EAAIZ,aAAeY,EAAIX,uBAAuB,iBAAiB,GARvDgC,EAAAA,aAAQM,QAAR3B,EAAoBsB,OAEpBtB,EAAAV,UAAAU,EAAAX,uBAAA,oBAAA,GAfJW,EAAAV,UAAAqC,YAAA3B,EAAAc,KA2BGd,EAHHV,CAAgBD,GAGpBe,OAAAyB,iBAAA,SAAA,WAAA,OAAA7B,EAAAG,mBACDC,OA1FDyB,iBAAA,OAAA,WAAA,OAAA7B,EAAAG,mBA4FAlB,EAAMA,iBAAgBE,UAAAA,SAAAA,GAAtB,IAAsBA,EAAtB2C,EAAsB3C,QAAqB4C,EAA3CD,EAA2CC,OAA3CC,EAAAF,EAAAE,QACM1C,GAAYJ,GAASC,IAAAA,IACrBI,EAAAA,SACGS,EAAGD,cAENC,EAAC6B,SAAAA,GAAAA,WACyBvC,EAAhC2C,aAAAjC,EAAAT,GAvGF","file":"read-bar.js","sourcesContent":["// To the extent possible under law, the author(s) have dedicated all copyright\n// and related and neighbouring rights to this software and all related code\n// files to the public domain worldwide. A copy of the CC0 Public Domain\n// Dedication may be obtained at:\n//\n//     http://creativecommons.org/publicdomain/zero/1.0/\n//\n// Unless required by applicable law or agreed to in writing, this software is\n// distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n// KIND, either express or implied.\n\n/* eslint-disable require-jsdoc */\n\n(() => {\n  const basePadding = 40;\n\n  const ReadBar = function (article) {\n    const bar = (() => {\n      const template = document.createElement('div');\n      template.innerHTML = `\n        <aside class=\"read-bar\">\n          <button class=\"toggle-button\" aria-hidden=\"true\" tabindex=\"-1\"></button>\n          <div class=\"scroll-container\"></div>\n        </aside>`.trim();\n      template.firstChild.style.display = 'none';\n      return template.firstChild;\n    })();\n\n    bar.isExpanded = () => bar.classList.contains('expanded');\n\n    bar.updatePosition = function () {\n      if (bar.style.display == 'none') {\n        bar.style.display = 'block';\n      }\n\n      if (window.innerWidth <\n        article.clientWidth + 2 * basePadding + this.clientWidth) {\n        this.toggleButton.disabled = false;\n      } else {\n        if (bar.isExpanded()) {\n          bar.classList.remove('expanded');\n        }\n        this.toggleButton.disabled = true;\n      }\n\n      if (!bar.isExpanded()) {\n        const left = article.clientWidth + 2 * basePadding + 'px';\n        if (this.style.left != left) {\n          this.style.left = left;\n        }\n      } else {\n        this.style.left = '';\n      }\n    };\n\n    bar.setExpanded = function (expanded) {\n      if (expanded) {\n        bar.classList.add('expanded');\n        bar.updatePosition();\n      } else {\n        bar.classList.remove('expanded');\n        bar.updatePosition();\n      }\n    };\n\n    bar.toggle = function () {\n      if (bar.isExpanded()) {\n        bar.setExpanded(false);\n      } else {\n        bar.setExpanded(true);\n      }\n    };\n\n    bar.toc = (() => {\n      const root = document.createElement('ul');\n      root.className = 'toc-list';\n      for (let i = 0; i < article.children.length; i++) {\n        const node = article.children[i];\n        switch (node.nodeName) {\n          case 'H2':\n          case 'H3':\n          case 'H4':\n          case 'H5':\n          case 'H6':\n            const newNode = document.createElement('li');\n            const newNodeContent = document.createElement('a');\n            newNodeContent.className = node.nodeName;\n            newNodeContent.innerHTML = node.innerHTML;\n            newNodeContent.href = '#' + node.id;\n            newNodeContent.onfocus = () => bar.setExpanded(true);\n            newNodeContent.onblur = () => bar.setExpanded(false);\n            newNode.appendChild(newNodeContent);\n            root.appendChild(newNode);\n            break;\n        }\n      }\n      return root;\n    })();\n\n    bar.toggleButton = bar.getElementsByClassName('toggle-button')[0];\n    bar.toggleButton.onclick = bar.toggle;\n\n    bar.container = bar.getElementsByClassName('scroll-container')[0];\n    bar.container.appendChild(bar.toc);\n\n    return bar;\n  };\n\n  const body = document.getElementsByTagName('body')[0];\n  const container = document.getElementsByTagName('main')[0];\n  const article = container.getElementsByTagName('article')[0];\n  const bar = new ReadBar(article);\n\n  window.addEventListener('resize', () => bar.updatePosition());\n  window.addEventListener('load', () => bar.updatePosition());\n\n  body.addEventListener('keydown', ({ ctrlKey, altKey, keyCode }) => {\n    if (ctrlKey && altKey && keyCode == 82) {\n      bar.toggle();\n      if (bar.isExpanded()) {\n        bar.children[0].focus();\n      }\n    }\n  });\n\n  container.insertBefore(bar, article);\n})();\n"]}